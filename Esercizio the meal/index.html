<!DOCTYPE html>

	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Prelibatezze culinarie</title>
       
       
       <script>
        if( localStorage.getItem("utente") == null) {
            window.location.href = login.html;
        }
        </script>
	
</head>
	<body>
		<header></header>

		<main>
			<h1>Lista piatti</h1>

			<h2>
				Bentornato ti aspettavamo
				<span id="nome-a-schermo"></span>
			</h2>

			<p> Quale piatto vorresti vedere?</p>

			<input type="text" id="scelta-piatti" />
			<button onclick="ricerca_async()">Cerca</button>
            <button onclick="logout_to_index()">Logout</button>
			
            <section id="sezione-piatti"></section>
		</main>

		<footer></footer>

		<script>
			

			async function ricerca_async() {
				let sceltaPiatto = document.getElementById("scelta-piatti").value;

				let ricerca = await fetch(
					`https://www.themealdb.com/api/json/v1/1/search.php?s=${sceltaPiatto}`,
				);

				let lista_piatti = await ricerca.json();
				console.log("lista_piatti");

				crea_card_piatti(lista_piatti.meals);
			}

			function crea_card_piatti(lista_piatti) {
				for (let i = 0; i < lista_piatti.length; i++) {

					let div = document.createElement("div");
					let nomePiatto = document.createElement("h3");
					let origini = document.createElement("h4");
					let imagePiatto = document.createElement("img");
					let preparazione = document.createElement("p");

					nomePiatto.innerHTML = lista_piatti[i].strMeal;

					origini.innerHTML = lista_piatti[i].strArea;

					imagePiatto.src = lista_piatti[i].strMealThumb;
					imagePiatto.width = 300;
					imagePiatto.height = 300;

					preparazione.innerHTML = lista_piatti[i].strInstructions;

					div.appendChild(nomePiatto);
					div.appendChild(origini);
					div.appendChild(imagePiatto);
					div.appendChild(preparazione);

					document.getElementById("sezione-piatti").appendChild(div);
				}
			}

            function logout_to_index(){
                localStorage.removeItem("utente");
                window.location.href = "index.html";
            }

			let nuovoUtente = JSON.parse(localStorage.getItem("utente"));
            document.getElementById("nome-utente").innerHTML = nuovoUtente.username + "" + nuovoUtente.password;
		
        </script>
	</body>
</html>